<!DOCTYPE html5>
<html>
	<head>
		<script src="js/jquery-2.1.4.min.js" type="text/javascript"></script>
		<script type="text/javascript">
		
			function createTable(id){
					var valor = [{ name: "id", value: id }];
					$.post( "pages/selectHorarioDoc.php", valor, function(data){
						var $data = JSON.parse(data);
						console.log($data);
						$("#results").html("");
						/*if($data.length){
							var table = '<table class="tableSearch"><tr>';
							table += '<th>Nro</th>';
							table += '<th>Codigo Cur.</th>';
							table += '<th>Docente</th>';
							table += '<th>Dia</th>';
							table += '<th>Hora Inicio</th>';
							table += '<th>Hora Fin</th>';
							table += '<th class="classHide">cc_id</th>';
							table += '<th class="classHide">docente_id</th>';
							table += '<th class="classHide">carrera_id</th>';
							table += '<th></th>';
							table += '<th></th>';
							$.each($data, function( index, value ) {
								table += '<tr class="rowSelect">';
								table += '<td>'+ (index + 1) +'</td>';
								table += '<td>'+ value['cc_codigo'] +'</td>';
								table += '<td>'+ value['docente_nombre']+" "+value['docente_apellido_pat']+" "+value['docente_apellido_mat']  +'</td>';
								table += '<td>'+ value['horario_dia'] +'</td>';
								table += '<td>'+ value['horario_hora_ini'] +'</td>';
								table += '<td>'+ value['horario_hora_fin'] +'</td>';
								table += '<td class="classHide">'+ value['cc_id'] +'</td>';
								table += '<td class="classHide">'+ value['docente_id'] +'</td>';
								table += '<td class="classHide">'+ value['carrera_id'] +'</td>';
								table += '<td><button class="btnEdit" type="button" name='+ value['horario_id'] +'>Editar</button></td>';
								table += '<td><button class="btnDelete" type="button" name='+ value['horario_id'] +'>Eliminar</button></td>';
								table += '</tr>';
							});
							table += '</table>';
							$("#results").html(table);
						}*/
					});
			}
			
			function showData(data){
				$('.dataAssist').html("");
				$('#tem').html("<b>Tema: </b>"+data['asistencia_tema']);
				$('#fec').html("<b>Fecha: </b>"+data['asistencia_fecha']);
				$('#doc').html("<b>Docente: </b>"+data['docente_nombre']+" "+data['docente_apellido_pat']+" "+data['docente_apellido_mat']);
				$('#cur').html("<b>Curso: </b>"+data['curso_nombre']+" - "+data['cc_codigo']);
				if(data['asistencia_sig'] == "+"){
					$("#dif").css('color', 'green');
				}else{
					$("#dif").css('color', 'red');
				}
				$('#dif').html("<b>"+data['asistencia_sig']+""+data['asistencia_dif']+" min</b>");
				$('#hini').html("<b>Hora de Inicio: </b>"+data['horario_hora_ini']);
				$('#hchk').html("<b>Hora Marcada: </b>"+data['asistencia_hora_ingreso']);
				$('#hfin').html("<b>Hora de Salida: </b>"+data['horario_hora_fin']);
			}
			
			function searchData(id){
				var valor = [{ name: "id", value: id }];
				$.post( "pages/searchData.php", valor, function(data){
					var $data = JSON.parse(data);
					showData($data[0]);
					createTable($data[0]['docente_id']);
				});
			}
			
			function insertTema(id, tema){
				var valor = [{ name: "id", value: id }, { name: "tema", value: tema }];
				$.post( "pages/asignarTema.php", valor, function(data){
					var $data = JSON.parse(data);
					if($data[0]){
						searchData(id);
					}
				});
			}
		
			$(document).ready(function (){
				$('#dni').focus();
				$('#dni').keyup(function(e){
					if(e.keyCode == 13){
						var valor = [{ name: "cod", value: $("#dni").val() }];
						$.post( "pages/verificarAsistencia.php", valor, function(data){
							var $data = JSON.parse(data);
							if($data[0]){
								$('#dni').blur();
								var $tema = prompt("Ingrese el tema", "");
								insertTema($data[2], $tema);
							}
							if($data[1][0]){ $("#msjAssist").css('color', 'green'); }else{ $("#msjAssist").css('color', 'red'); }
							$('#msjAssist').text($data[1][1]);
						});
					}
				});
			});
		</script>
	</head>
	<body>
		<div id="content_form">
			<table border=0>
				<tr>
					<td><label class="form-group">Ingrese Codigo</label></td>
					<td><input name="dni" type="text" class="form-control" id="dni" placeholder="dni"></td>
				</tr>
				<tr>
					<td colspan="2"><label class="rptaForm" id="msjAssist"></label></td>
				</tr>
			</table>
			<table id="tableData">
				<tr>
					<td colspan="2"><label class="dataAssist" id="tem"></label></td>
					<td><label class="dataAssist" id="fec"></label></td>
				<tr>
				<tr>
					<td><label class="dataAssist" id="doc"></label></td>
					<td><label class="dataAssist" id="cur"></label></td>
					<td><label class="dataAssist" id="dif"></label></td>
				<tr>
				</tr>
					<td><label class="dataAssist" id="hini"></label></td>
					<td><label class="dataAssist" id="hchk"></label></td>
					<td><label class="dataAssist" id="hfin"></label></td>
				</tr>
			</table>
		</div>
		<div id="search_form">			
			<div id="results">
			</div>
		<div>
	</body>
</html>